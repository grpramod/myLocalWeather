!function(){function e(){console.log("updating weather data..."),t()}function o(){console.log("Extension installed and initialized.."),console.log("clearing cache..."),chrome.storage.sync.clear(),t=function(){console.log(navigator.geolocation),navigator.geolocation?(console.log("getting location..."),navigator.geolocation.getCurrentPosition(i,c)):(n="Geolocation is not supported by this browser.",chrome.storage.sync.set({error:n}))};var o=function(e,o,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){if(200===this.status){var e=JSON.parse(this.responseText);console.log(e),void 0!==e.main&&(window.chrome.browserAction.setBadgeText({text:Math.round(e.main.temp).toString()+" F"}),o(e)),void 0!==e.list&&o(e)}else n="Internal Error!",chrome.storage.sync.set({error:n})},r.onerror=function(){n="Server Error!",chrome.storage.sync.set({error:n})},r.send()},a=function(e){console.log("setting current data",e),chrome.storage.sync.set({currentData:e})},s=function(e){console.log("setting forecast data ",e),chrome.storage.sync.set({forecastData:e})},i=function(e){r.lat=e.coords.latitude,r.lng=e.coords.longitude,chrome.storage.sync.set({locationInfo:[{lat:r.lat,lng:r.lat}]}),o("http://api.openweathermap.org/data/2.5/weather?lat="+r.lat+"&lon="+r.lng+"&appid=708518532a791afde6d31d0fa4783fbf&units=imperial",a),o("http://api.openweathermap.org/data/2.5/forecast/daily?lat="+r.lat+"&lon="+r.lng+"&appid=708518532a791afde6d31d0fa4783fbf&units=imperial",s)},c=function(e){switch(console.log("Some error.."),e.code){case e.PERMISSION_DENIED:n="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:n="Location information is unavailable.";break;case e.TIMEOUT:n="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:n="An unknown error occurred.";break;default:n="An unknown error occurred."}chrome.storage.sync.set({error:n})};t(),chrome.alarms.create("updateWeather",{periodInMinutes:360}),chrome.alarms.onAlarm.addListener(e)}var t,r={lat:"",lng:""},n="";chrome.runtime.onInstalled.addListener(o),chrome.runtime.onStartup.addListener(o)}();